01 Quantidade Total = 
SUM(fVendas[Quantidade])

02 Frete Total = 
SUM(fVendas[VL.Frete])

03 Quantidade MÃ¡xima por Item = 
MAX(fVendas[Quantidade])

04 Qtde MÃ©dia por Item de venda = 
AVERAGE(fVendas[Quantidade])

05 Total Venda Bruto = 
SUMX(fVendas, RELATED(dProduto[Valor Unitario])*[Quantidade])

06 MÃ©dia Bruta por Item = AVERAGEX(
    fVendas,
    fVendas[Quantidade]*RELATED(dProduto[Valor Unitario])
)

07 Total do Custo = 
sumx(fVendas,RELATED(dProduto[Custo UnitÃ¡rio])*fVendas[Quantidade])

08 Custo MÃ©dio por Item = 
AVERAGEX(fVendas, RELATED(dProduto[Custo UnitÃ¡rio])*fVendas[Quantidade])

09 MÃ¡ximo Item de Venda = 
MAXX(fVendas, fVendas[Quantidade]* RELATED(dProduto[Valor Unitario])
)

10 MÃ­nimo Item de Venda = MINX(fVendas,
fVendas[Quantidade]*RELATED(dProduto[Valor Unitario])
)

11 Quantidade de vendas = 
DISTINCTCOUNT(fVendas[idNota])

12 Quantidade de Itens de venda = 
COUNTROWS(fVendas)

13 Total do Desconto = 
SUMX(fVendas,[05 Total Venda Bruto]*(fVendas[Desconto]/100)
)

14 Receita LÃ­quida = 
[05 Total Venda Bruto]-[15 Descontos totais]

15 Descontos totais = 
[07 Total do Custo]+[13 Total do Desconto]+[02 Frete Total]

16 Ticket MÃ©dio = 
DIVIDE([05 Total Venda Bruto],[11 Quantidade de vendas],0)

17 Margem de Lucro (%) = 
DIVIDE([14 Receita LÃ­quida],[05 Total Venda Bruto])

18 Quantidade de Clientes na Base = 
COUNTROWS(dCliente)

19 Quantidade de Clientes Positivados = 
DISTINCTCOUNT(fVendas[Cliente])

20 Clientes nÃ£o positivados = 
COUNTROWS(EXCEPT(VALUES(dCliente[idCliente]), VALUES(fVendas[Cliente])))

21 America do Norte Vendas = 
CALCULATE([05 Total Venda Bruto],
dLocal[Continente] = "AmÃ©rica do Norte"
)

22 America do Norte Clientes Positivados = 
CALCULATE([19 Quantidade de Clientes Positivados], 
dLocal[Continente] = "AmÃ©rica do Norte" )

23 America do Norte Quantidade de Vendas = 
CALCULATE([11 Quantidade de vendas], 
dLocal[Continente] = "AmÃ©rica do Norte")

24 America do Norte Receita LÃ­quida = 
CALCULATE([14 Receita LÃ­quida],
dLocal[Continente] = "AmÃ©rica do Norte")


37 ClassificaÃ§Ã£o Produto = 
SWITCH(
    TRUE(),
    [14 Receita LÃ­quida] > 4000000, "Excelente",
    [14 Receita LÃ­quida] > 3000000, "Muito Bom",
    [14 Receita LÃ­quida] > 2000000, "Bom",
    [14 Receita LÃ­quida] > 1000000, "SatisfatÃ³rio",
    [14 Receita LÃ­quida] > 700000, "Regular",
    [14 Receita LÃ­quida] > 600000, "Avaliar",
    [14 Receita LÃ­quida] > 400000, "AtenÃ§Ã£o",
    "Ruim"
    )


38 VisÃ£o America do Norte = 
SWITCH(
    FIRSTNONBLANK(TbMedidas[CÃ³digo], "BRT"),
    "BRT", [21 America do Norte Vendas],
    "QTC", [22 America do Norte Clientes Positivados],
    "QTV", [23 America do Norte Quantidade de Vendas],
    "LIQ", [24 America do Norte Receita LÃ­quida]

)



42 Top 1 Margem de Lucro = 
var TbAux = 
SUMMARIZE(
    dLocal,
    dLocal[PaÃ­s],
    "Lucro(%)",
    [17 Margem de Lucro (%)]
)


RETURN

MAXX(
    TbAux,
    [Lucro(%)]
)

43 Top 1 Lucro (%) America do Norte = 
CALCULATE(
    [42 Top 1 Margem de Lucro],
    dLocal[Continente] = "AmÃ©rica do Norte")

47 VisÃ£o Geral = 
SWITCH(
    FIRSTNONBLANK(TbMedidas[CÃ³digo], "BRT"),
    "BRT", [05 Total Venda Bruto],
    "QTC",[19 Quantidade de Clientes Positivados],
    "QTV",[11 Quantidade de vendas],
    "LIQ", [14 Receita LÃ­quida]

)

48 Qtde PaÃ­ses Values = 
var TbValues = Values (dLocal[PaÃ­s])
Return
CountRows (TbValues)

49 Qtde PaÃ­ses All = 
var TbAll = ALL(dLocal[PaÃ­s])

Return

COUNTROWS(TbAll)

50 Faturamento Bruto Total = 
CALCULATE([05 Total Venda Bruto], 
ALL(dVendedor)
)

51 Valor Bruto Percentual = 
DIVIDE([05 Total Venda Bruto],
[50 Faturamento Bruto Total],0)

52 Faturamento LÃ­quido Total = CALCULATE([14 Receita LÃ­quida], 
ALLSELECTED(dLocal)
)

53 Valor (%) LÃ­quido por PaÃ­ses selecionado = DIVIDE([14 Receita LÃ­quida],
[52 Faturamento LÃ­quido Total],0)

54 Ranking Gerentes = 
var TbGerentes = ALL(dVendedor[Gerente])

Return

RANKX(
    TbGerentes,
    [05 Total Venda Bruto]
)

55 Frete Clientes A = 
SUMX(
    FILTER(
    fVendas,
    RELATED(dCliente[Classificacao]) = "A"

    ),
    [02 Frete Total]

)


56 Faturamento TOP1 = 

Var TbGerentes = All(dVendedor[Gerente])

Return

Calculate(
    [05 Total Venda Bruto],
    FILTER(
        TbGerentes,
        [54 Ranking Gerentes] = 1
    )
)

57 Faturamento TOP2 = 

Var TbGerentes = All(dVendedor[Gerente])

Return

Calculate(
    [05 Total Venda Bruto],
    FILTER(
        TbGerentes,
        [54 Ranking Gerentes] = 2
    )
)


58 Faturamento TOP3 = 

Var TbGerentes = All(dVendedor[Gerente])

Return

Calculate(
    [05 Total Venda Bruto],
    FILTER(
        TbGerentes,
        [54 Ranking Gerentes] = 3
    )
)

59 Rank URL Gerente = 
RANKX(
    ALL(dVendedor[URL Gerente]),
    [05 Total Venda Bruto]
    )


60 Vendas Ano Atual = 
var AnoAtual =
MAX ( 
    dCalendario[Ano]
)

RETURN

CALCULATE(
    [05 Total Venda Bruto],
    dCalendario[Ano] = AnoAtual
)

61 Meta do Ano = 

var AnoAtual = MAX(dCalendario[Ano])

RETURN

CALCULATE(
    SUM(fMetas[Meta]),
    dCalendario[Ano] = AnoAtual
)

62 VariaÃ§Ã£o da Meta = 
[60 Vendas Ano Atual] - [61 Meta do Ano]

63 VariaÃ§Ã£o da Meta(%) = 
DIVIDE(
    [62 VariaÃ§Ã£o da Meta],
    [61 Meta do Ano])

64 Vendas Ano Anterior = 
VAR VVendas = 
CALCULATE(
    [60 Vendas Ano Atual],
    DATEADD(dCalendario[Data], - 1 , YEAR
    ))

RETURN

IF(ISBLANK(VVendas),0, VVendas)

65 VariaÃ§Ã£o Faturamento (%) = 
var VVariacao =

DIVIDE(
    [60 Vendas Ano Atual]-[64 Vendas Ano Anterior],
    [64 Vendas Ano Anterior],
    BLANK()
    )

RETURN 

IF (ISBLANK(VVariacao),0,VVariacao)

66 Total Faturamento Bruto = 
CALCULATE(
    [05 Total Venda Bruto],
    USERELATIONSHIP(
        fVendas[Data de Faturamento],
        dCalendario[Data]
    )
)
*

67 Receita liquida do Ano PY = 
CALCULATE(
    [14 Receita LÃ­quida],
    SAMEPERIODLASTYEAR(dCalendario[Data])
)


68 Receita LÃ­quida YoY = 
[14 Receita LÃ­quida] - [67 Receita liquida do Ano PY]


69 Receita LÃ­quid YoY(%) = 
DIVIDE(
    [68 Receita LÃ­quida YoY],
    [67 Receita liquida do Ano PY],
    0

)

70 Receita LÃ­quida Total Gerla = 
CALCULATE(
    [14 Receita LÃ­quida],
    ALL(dCalendario)

)


70 Receita LÃ­quida Total Gerla = 
CALCULATE(
    [14 Receita LÃ­quida],
    ALL(dCalendario)

)


72 Receita LÃ­quida Total do Ano = 
CALCULATE(

    [14 Receita LÃ­quida],
    ALL(dCalendario[MÃªs])
)


73  VariaÃ§Ã£o Receita LÃ­quida Total no Ano = 
[14 Receita LÃ­quida]/[72 Receita LÃ­quida Total do Ano]


74 Receita LÃ­quida Acumulada = 
CALCULATE(
    [14 Receita LÃ­quida],
    DATESYTD((dCalendario[Data]))

)

75 Receita Anual LÃ­quida Acumulada = 
TOTALYTD(
    [14 Receita LÃ­quida],
    dCalendario[Data]
)


76 Receita LÃ­quda Acumulada = 
CALCULATE(
    [14 Receita LÃ­quida],
    DATESBETWEEN(
        dCALENDARIO[DATA],
        BLANK(),
        MAX(dCalendario[Data])
    )
)

77 Acumulado MÃ³vel 3M = 
CALCULATE(
    [14 Receita LÃ­quida],
    DATESINPERIOD(
        dCalendario[Data],
        MAX(dCalendario[Data]),
        -3,
        MONTH
    )
)

78 SIM Venda Bruta = 
[05 Total Venda Bruto]*
( 1 + [SIMQuantidade Valor 2] * (1 + [SIMPreco Valor]))

79 SIM VariaÃ§Ã£o Venda = 
[78 SIM Venda Bruta] - [05 Total Venda Bruto]

80 SIM Custos = 
[07 Total do Custo] * 
(1 + [SIMQuantidade Valor 2]) * (1 +[SIMCustos Valor])

81 SIM VariaÃ§Ã£o Custo = 

[80 SIM Custos]-[07 Total do Custo]

82 SIM Frete = 

[02 Frete Total]*(1 + [SIMFrete Valor])

83 SIM variaÃ§Ã£o Frete = 
[79 SIM VariaÃ§Ã£o Venda] - [02 Frete Total]

84 SIM Desconto = 
[13 Total do Desconto]* (1 +[Desconto Valor])

85 SIM VariaÃ§Ã£o desconto = 
[83 SIM variaÃ§Ã£o Frete] - [13 Total do Desconto]

86 SIM da receita lÃ­quida = 
[78 SIM Venda Bruta] -
([82 SIM Frete]+[80 SIM Custos]+[84 SIM Desconto])

87 SIM VariaÃ§Ã£o da Receita = 
[86 SIM da receita lÃ­quida] - [14 Receita LÃ­quida]

88 SIM Margem de Lucro percentual (%) = 
DIVIDE(
    [86 SIM da receita lÃ­quida],
    [78 SIM Venda Bruta],
    0
)

89 SIM VariaÃ§Ã£o receita (%) = 
DIVIDE(
    [86 SIM da receita lÃ­quida],
    ABS([14 Receita LÃ­quida]),
    0
) -1

90 KPI de Receita = 
SWITCH(
    TRUE(),
    [89 SIM VariaÃ§Ã£o receita (%)]>0.00000001, "ðŸŸ¢",
    [89 SIM VariaÃ§Ã£o receita (%)]< -0.00000001,"ðŸ”´",
    "ðŸŸ£"
)

91 Cross NÃºmero de Vendas = 
Var TbVendas = VALUES(fVendas[idNota])

VAR TdVendasAux =
CALCULATETABLE(
    VALUES(fVendas[idNota]),
    ALL(dProduto),
    USERELATIONSHIP(fVendas[Produto],'Aux Produto'[IdProduto])
)

Var TbInter = INTERSECT(TbVendas, TdVendasAux)

Var vResultado = COUNTROWS(TbInter)

RETURN
IF(
    SELECTEDVALUE(dProduto[Sub-Categoria])<> SELECTEDVALUE('Aux Produto'[Sub-Categoria]),
    vResultado,BLANK()
)

92 Cross VariaÃ§Ã£o = 
DIVIDE(
    [91 Cross NÃºmero de Vendas],
    [11 Quantidade de vendas],
    0
)


93 Janeiro Cross Sell = 
CALCULATE(
    [91 Cross NÃºmero de Vendas],
    dCalendario[MÃªs] = 1
)

SE (%) Receita LÃ­quida = 
DIVIDE(
    [14 Receita LÃ­quida],
    [SE Receita LÃ­quida],
    0


)

SE Ano Anterior = 

[SE Ano Selecionado]-1

SE Ano Selecionado = 
VAR Vano = 
SELECTEDVALUE(dCalendario[Ano])

RETURN

IF(ISBLANK(Vano), MAX(dCalendario[Ano]), Vano)

SE Quantidade MÃ­nima = MIN(fVendas[Quantidade])


SE Receita LÃ­quida = 
CALCULATE(
    [14 Receita LÃ­quida],
    all (dLocal)
        

)

Teste Receita LÃ­quida PM = 
CALCULATE(
    [14 Receita LÃ­quida],
    DATEADD(
        dCalendario[Data],-1,MONTH)
)







